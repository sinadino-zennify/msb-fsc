<template>
    <lightning-card>
        <div class="slds-p-horizontal_medium">
            <!-- Dev Mode Banner -->
            <template if:true={devMode}>
                <div class="slds-m-bottom_small">
                    <div class="slds-notify slds-notify_alert slds-alert_warning" role="alert">
                        <span class="slds-assistive-text">warning</span>
                        <h2>ðŸš€ DEV MODE ACTIVE - Validation bypassed, quick navigation enabled</h2>
                    </div>
                </div>
            </template>

            <!-- Dev Mode Step Navigator -->
            <template if:true={devMode}>
                <div class="slds-m-bottom_medium">
                    <lightning-card title="Quick Step Navigation" icon-name="utility:jump_to_top">
                        <div class="slds-p-around_small">
                            <div class="slds-grid slds-wrap slds-gutters_x-small">
                                <template for:each={progressSteps} for:item="step" for:index="index">
                                    <div key={step.developerName} class="slds-col slds-size_1-of-4 slds-m-bottom_x-small">
                                        <lightning-button
                                            label={step.stepLabel}
                                            title={step.developerName}
                                            data-step-index={index}
                                            onclick={handleJumpToStep}
                                            variant={step.buttonVariant}
                                            class="slds-size_1-of-1">
                                        </lightning-button>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </lightning-card>
                </div>
            </template>

            <!-- Progress Indicator -->
            <template if:true={steps}>
                <div class="slds-m-bottom_medium">
                    <lightning-progress-indicator 
                        current-step={currentStepDeveloperName}
                        type="path"
                        variant="base">
                        <template for:each={progressSteps} for:item="step">
                            <lightning-progress-step 
                                key={step.developerName}
                                label={step.stepLabel}
                                value={step.developerName}>
                            </lightning-progress-step>
                        </template>
                    </lightning-progress-indicator>
                </div>

            </template>

            <!-- Error Display -->
            <template if:true={error}>
                <div class="slds-m-bottom_medium">
                    <div class="slds-notify slds-notify_alert slds-alert_error">
                        <span class="slds-assistive-text">Error</span>
                        <h2>Failed to load wizard configuration</h2>
                        <p>{error.body.message}</p>
                    </div>
                </div>
            </template>

            <!-- Step Content -->
            <template if:true={currentStep}>
                <div class="slds-m-bottom_medium">
                    <c-dao-wizard-step-router 
                        lwc:ref="stepRouter"
                        record-id={recordId}
                        application-form-id={applicationFormId}
                        wizard-api-name={wizardApiName}
                        step-config={currentStep}
                        value={currentStepValue}
                        onpayloadchange={handlePayloadChange}>
                    </c-dao-wizard-step-router>
                </div>
            </template>

            <!-- Loading Spinner -->
            <template if:true={showSpinner}>
                <div class="slds-is-relative slds-m-vertical_medium" style="height: 100px;">
                    <lightning-spinner 
                        alternative-text="Loading..."
                        size="medium">
                    </lightning-spinner>
                </div>
            </template>
        </div>

        <!-- Navigation Footer -->
        <div slot="footer">
            <div class="slds-grid slds-grid_align-spread">
                <div class="slds-col">
                    <lightning-button 
                        label="Previous"
                        onclick={handlePrevious}
                        disabled={disablePreviousButton}
                        variant="neutral">
                    </lightning-button>
                </div>
                <div class="slds-col slds-text-align_center">
                    <lightning-button 
                        label="Save & Exit"
                        onclick={handleSaveAndExit}
                        disabled={disableSaveAndExitButton}
                        variant="neutral">
                    </lightning-button>
                </div>
                <div class="slds-col slds-text-align_right">
                    <lightning-button 
                        label={nextButtonLabel}
                        onclick={handleNext}
                        variant="brand"
                        disabled={disableNextButton}>
                    </lightning-button>
                </div>
            </div>
        </div>
    </lightning-card>
</template>